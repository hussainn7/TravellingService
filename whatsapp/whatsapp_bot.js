const fs = require('fs');
const qrcode = require('qrcode-terminal');
const { Client, LocalAuth } = require('whatsapp-web.js');
const axios = require('axios'); // Import axios for making HTTP requests
const xml2js = require('xml2js'); // Import xml2js for XML parsing
require('dotenv').config(); // Load environment variables

class WhatsAppBot {
    constructor() {
        this.client = new Client({
            authStrategy: new LocalAuth(),
            puppeteer: {
                headless: true,
                args: [
                    '--no-sandbox',
                    '--disable-setuid-sandbox',
                    '--disable-dev-shm-usage',
                    '--disable-accelerated-2d-canvas',
                    '--no-first-run',
                    '--no-zygote',
                    '--disable-gpu'
                ]
            }
        });

        this.userData = new Map(); // Store user data
        this.countries = this.loadCountries(); // Load country list
        this.setupEventHandlers();

        // Hardcoded API credentials
        this.OPENAI_API_KEY = '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';
        this.TOURVISOR_LOGIN = 'admotionapp@gmail.com'; // Replace with your actual login
        this.TOURVISOR_PASS = 'jqVZ4QLNLBN5'; // Replace with your actual password
    }

    loadCountries() {
        // Define the list of countries
        return [
            { id: "46", name: "–ê–±—Ö–∞–∑–∏—è" },
            { id: "31", name: "–ê–≤—Å—Ç—Ä–∏—è" },
            { id: "55", name: "–ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω" },
            { id: "71", name: "–ê–ª–±–∞–Ω–∏—è" },
            { id: "17", name: "–ê–Ω–¥–æ—Ä—Ä–∞" },
            { id: "88", name: "–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞" },
            { id: "53", name: "–ê—Ä–º–µ–Ω–∏—è" },
            { id: "72", name: "–ê—Ä—É–±–∞" },
            { id: "59", name: "–ë–∞—Ö—Ä–µ–π–Ω" },
            { id: "57", name: "–ë–µ–ª–∞—Ä—É—Å—å" },
            { id: "20", name: "–ë–æ–ª–≥–∞—Ä–∏—è" },
            { id: "39", name: "–ë—Ä–∞–∑–∏–ª–∏—è" },
            { id: "44", name: "–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è" },
            { id: "37", name: "–í–µ–Ω–≥—Ä–∏—è" },
            { id: "90", name: "–í–µ–Ω–µ—Å—É—ç–ª–∞" },
            { id: "16", name: "–í—å–µ—Ç–Ω–∞–º" },
            { id: "38", name: "–ì–µ—Ä–º–∞–Ω–∏—è" },
            { id: "6", name: "–ì—Ä–µ—Ü–∏—è" },
            { id: "54", name: "–ì—Ä—É–∑–∏—è" },
            { id: "11", name: "–î–æ–º–∏–Ω–∏–∫–∞–Ω–∞" },
            { id: "1", name: "–ï–≥–∏–ø–µ—Ç" },
            { id: "30", name: "–ò–∑—Ä–∞–∏–ª—å" },
            { id: "3", name: "–ò–Ω–¥–∏—è" },
            { id: "7", name: "–ò–Ω–¥–æ–Ω–µ–∑–∏—è" },
            { id: "29", name: "–ò–æ—Ä–¥–∞–Ω–∏—è" },
            { id: "92", name: "–ò—Ä–∞–Ω" },
            { id: "14", name: "–ò—Å–ø–∞–Ω–∏—è" },
            { id: "24", name: "–ò—Ç–∞–ª–∏—è" },
            { id: "78", name: "–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω" },
            { id: "40", name: "–ö–∞–º–±–æ–¥–∂–∞" },
            { id: "79", name: "–ö–∞—Ç–∞—Ä" },
            { id: "51", name: "–ö–µ–Ω–∏—è" },
            { id: "15", name: "–ö–∏–ø—Ä" },
            { id: "60", name: "–ö–∏—Ä–≥–∏–∑–∏—è" },
            { id: "13", name: "–ö–∏—Ç–∞–π" },
            { id: "10", name: "–ö—É–±–∞" },
            { id: "80", name: "–õ–∏–≤–∞–Ω" },
            { id: "27", name: "–ú–∞–≤—Ä–∏–∫–∏–π" },
            { id: "36", name: "–ú–∞–ª–∞–π–∑–∏—è" },
            { id: "8", name: "–ú–∞–ª—å–¥–∏–≤—ã" },
            { id: "50", name: "–ú–∞–ª—å—Ç–∞" },
            { id: "23", name: "–ú–∞—Ä–æ–∫–∫–æ" },
            { id: "18", name: "–ú–µ–∫—Å–∏–∫–∞" },
            { id: "81", name: "–ú—å—è–Ω–º–∞" },
            { id: "82", name: "–ù–µ–ø–∞–ª" },
            { id: "9", name: "–û–ê–≠" },
            { id: "64", name: "–û–º–∞–Ω" },
            { id: "87", name: "–ü–∞–Ω–∞–º–∞" },
            { id: "35", name: "–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è" },
            { id: "47", name: "–†–æ—Å—Å–∏—è" },
            { id: "93", name: "–°–∞—É–¥–æ–≤—Å–∫–∞—è –ê—Ä–∞–≤–∏—è" },
            { id: "28", name: "–°–µ–π—à–µ–ª—ã" },
            { id: "58", name: "–°–µ—Ä–±–∏—è" },
            { id: "25", name: "–°–∏–Ω–≥–∞–ø—É—Ä" },
            { id: "43", name: "–°–ª–æ–≤–µ–Ω–∏—è" },
            { id: "2", name: "–¢–∞–∏–ª–∞–Ω–¥" },
            { id: "41", name: "–¢–∞–Ω–∑–∞–Ω–∏—è" },
            { id: "5", name: "–¢—É–Ω–∏—Å" },
            { id: "4", name: "–¢—É—Ä—Ü–∏—è" },
            { id: "56", name: "–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω" },
            { id: "26", name: "–§–∏–ª–∏–ø–ø–∏–Ω—ã" },
            { id: "34", name: "–§–∏–Ω–ª—è–Ω–¥–∏—è" },
            { id: "32", name: "–§—Ä–∞–Ω—Ü–∏—è" },
            { id: "22", name: "–•–æ—Ä–≤–∞—Ç–∏—è" },
            { id: "21", name: "–ß–µ—Ä–Ω–æ–≥–æ—Ä–∏—è" },
            { id: "19", name: "–ß–µ—Ö–∏—è" },
            { id: "52", name: "–®–≤–µ–π—Ü–∞—Ä–∏—è" },
            { id: "12", name: "–®—Ä–∏-–õ–∞–Ω–∫–∞" },
            { id: "69", name: "–≠—Å—Ç–æ–Ω–∏—è" },
            { id: "70", name: "–Æ–∂–Ω–∞—è –ö–æ—Ä–µ—è" },
            { id: "33", name: "–Ø–º–∞–π–∫–∞" },
            { id: "49", name: "–Ø–ø–æ–Ω–∏—è" }
        ];
    }

    setupEventHandlers() {
        // QR Code generation (only needed for first-time setup)
        this.client.on('qr', (qr) => {
            qrcode.generate(qr, { small: true });
            console.log('QR Code generated. Please scan with WhatsApp!');
        });

        // Ready event
        this.client.on('ready', () => {
            console.log('WhatsApp bot is ready!');
        });

        // Message handling
        this.client.on('message', async (msg) => {
            if (msg.fromMe) return; // Ignore messages from the bot itself
            await this.handleMessage(msg);
        });
    }

    async handleMessage(msg) {
        const userId = msg.from;
        console.log(`üì© Received message from user ${userId}: '${msg.body}'`);

        // Initialize user data if it doesn't exist
        if (!this.userData.has(userId)) {
            this.userData.set(userId, {
                isSearching: false,
                awaitingDeparture: false,
                awaitingCountry: false,
                awaitingNights: false,
                awaitingAdults: false,
                awaitingChildren: false,
                departure: null,
                country: null,
                nights: null,
                adults: null,
                children: null
            });
            // Send welcome message for new users
            await msg.reply('üëã –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –≤–∞—à —Ç—É—Ä–∞–≥–µ–Ω—Ç-–ø–æ–º–æ—â–Ω–∏–∫. –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º –Ω–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Ç—É—Ä –∏–ª–∏ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è—Ö.\n\n–ß—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ —Ç—É—Ä–∞, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ "—Ç—É—Ä".');
            return;
        }

        const userParams = this.userData.get(userId);

        // Check if user is in tour search mode
        if (msg.body.toLowerCase() === '—Ç—É—Ä') {
            userParams.isSearching = true;
            userParams.awaitingDeparture = true;
            await this.askDeparture(msg);
            return;
        }

        // If user is in search mode, handle tour search flow
        if (userParams.isSearching) {
            await this.handleTourSearch(msg, userParams);
        } else {
            // Use AI for general conversation
            const response = await this.getChatGPTResponse(msg.body);
            await msg.reply(response);
        }
    }

    async handleTourSearch(msg, userParams) {
        try {
            if (userParams.awaitingDeparture) {
                userParams.departure = msg.body; // Store the city name
                userParams.awaitingDeparture = false;
                userParams.awaitingCountry = true;
                await this.askCountry(msg);
            } else if (userParams.awaitingCountry) {
                const cityName = msg.body.trim();
                const countryId = await this.getCountryIdFromCity(cityName);
                if (countryId) {
                    userParams.country = countryId; // Store the country ID
                    userParams.awaitingCountry = false;
                    userParams.awaitingNights = true;
                    await this.askNights(msg);
                } else {
                    await msg.reply('üòî –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Å—Ç—Ä–∞–Ω—É –ø–æ –≥–æ—Ä–æ–¥—É. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É.');
                }
            } else if (userParams.awaitingNights) {
                const nights = msg.body.split('-').map(Number);
                if (nights.length === 2) {
                    userParams.nights = nights; // Store as an array [nightsFrom, nightsTo]
                    userParams.awaitingNights = false;
                    userParams.awaitingAdults = true;
                    await this.askAdults(msg);
                } else {
                    await msg.reply('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—á–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ "X-Y", –Ω–∞–ø—Ä–∏–º–µ—Ä "7-14".');
                }
            } else if (userParams.awaitingAdults) {
                userParams.adults = msg.body;
                userParams.awaitingAdults = false;
                userParams.awaitingChildren = true;
                await this.askChildren(msg);
            } else if (userParams.awaitingChildren) {
                userParams.children = msg.body;
                userParams.awaitingChildren = false;
                await this.confirmSearch(msg, userParams);
            }
        } catch (error) {
            console.error('Error in handleTourSearch:', error);
            await msg.reply('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ "—Ç—É—Ä" –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–Ω–æ–≤–æ.');
            this.resetUserState(msg.from);
        }
    }

    async confirmSearch(msg, userParams) {
        console.log(`Starting search with the following parameters:`);
        console.log(`Departure: ${userParams.departure}`); // This is the city name
        console.log(`Country ID: ${userParams.country}`); // This should be the country ID
        console.log(`Nights: ${userParams.nights.join('-')}`);
        console.log(`Adults: ${userParams.adults}`);
        console.log(`Children: ${userParams.children}`);

        await msg.reply('–•–æ—Ä–æ—à–æ, –Ω–∞—á–∏–Ω–∞–µ–º –ø–æ–∏—Å–∫...');

        // Proceed to start the tour search
        const requestId = await this.startTourSearch(msg, userParams);
        if (requestId) {
            await this.getSearchResults(requestId, msg); // Directly get results
        }
    }

    async formatSearchRequest(userParams) {
        const today = new Date();
        const dateFrom = new Date(today);
        dateFrom.setDate(today.getDate() + 1);
        const dateTo = new Date(today);
        dateTo.setDate(today.getDate() + 30);

        const formattedDateFrom = `${dateFrom.getDate().toString().padStart(2, '0')}.${(dateFrom.getMonth() + 1).toString().padStart(2, '0')}.${dateFrom.getFullYear()}`;
        const formattedDateTo = `${dateTo.getDate().toString().padStart(2, '0')}.${(dateTo.getMonth() + 1).toString().padStart(2, '0')}.${dateTo.getFullYear()}`;

        return `http://tourvisor.ru/xml/search.php?authlogin=${this.TOURVISOR_LOGIN}&authpass=${this.TOURVISOR_PASS}&departure=${userParams.country}&country=${userParams.country}&datefrom=${formattedDateFrom}&dateto=${formattedDateTo}&nightsfrom=${userParams.nights[0]}&nightsto=${userParams.nights[1]}&adults=${userParams.adults}&child=${userParams.children}&format=xml`;
    }

    async startTourSearch(msg, userParams) {
        const apiUrl = await this.formatSearchRequest(userParams);
        console.log(`Making API request to: ${apiUrl}`);

        try {
            const response = await axios.get(apiUrl);
            console.log(`API Response: ${response.data}`);
            const result = await this.parseApiResponse(response.data);
            return result.requestid; // Return the request ID for direct result fetching
        } catch (error) {
            console.error('Error making API request:', error);
            await msg.reply('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–∏—Å–∫ —Ç—É—Ä–æ–≤.');
            return null;
        }
    }

    async getSearchResults(requestId, msg) {
        const resultsUrl = `http://tourvisor.ru/xml/result.php?authlogin=${this.TOURVISOR_LOGIN}&authpass=${this.TOURVISOR_PASS}&requestid=${requestId}&type=result`;
        console.log(`Fetching results from: ${resultsUrl}`); // Print the result link

        // Set a timeout for the request
        const timeout = new Promise((_, reject) => setTimeout(() => reject(new Error('Timeout')), 15000));

        try {
            const response = await Promise.race([
                axios.get(resultsUrl),
                timeout
            ]);
            console.log(`Results Response: ${response.data}`);
            await this.handleResults(response.data, msg);
        } catch (error) {
            console.error('Error fetching results:', error);
            await msg.reply('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
        }
    }

    async handleResults(xmlData, msg) {
        const parser = new xml2js.Parser();
        parser.parseString(xmlData, (err, result) => {
            if (err) {
                console.error('Error parsing results:', err);
                msg.reply('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞.');
                return;
            }

            // Check if the result contains hotels
            const hotels = result.data.result[0].hotel;
            if (hotels && hotels.length > 0) {
                let responseMessage = 'üè® –ù–∞–π–¥–µ–Ω–Ω—ã–µ –æ—Ç–µ–ª–∏:\n';
                hotels.forEach(hotel => {
                    const hotelName = hotel.hotelname[0];
                    const price = hotel.price[0];
                    const description = hotel.hoteldescription[0];
                    const fullDescLink = hotel.fulldesclink[0];

                    // Extracting fly dates from tours
                    const tours = hotel.tours[0].tour;
                    const flyDates = tours.map(tour => tour.flydate[0]).join(', ');

                    responseMessage += `\nüè® –ù–∞–∑–≤–∞–Ω–∏–µ: ${hotelName}\nüí∞ –¶–µ–Ω–∞: ${price} —Ä—É–±.\n‚úàÔ∏è –î–∞—Ç—ã –≤—ã–ª–µ—Ç–∞: ${flyDates}\nüìù –û–ø–∏—Å–∞–Ω–∏–µ: ${description}\nüîó –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ: ${fullDescLink}\n`;
                });
                msg.reply(responseMessage);
            } else {
                msg.reply('üòî –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –æ—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –ø–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É.');
            }
        });
    }

    async parseApiResponse(xmlData) {
        const parser = new xml2js.Parser();
        return new Promise((resolve, reject) => {
            parser.parseString(xmlData, (err, result) => {
                if (err) {
                    reject(err);
                } else {
                    resolve(result.result);
                }
            });
        });
    }

    async getCountryIdFromCity(cityName) {
        // Predefined mapping of cities to country IDs
        const cityCountryMap = {
            "–ú–æ—Å–∫–≤–∞": 4,
            "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥": 4,
            "–•—É—Ä–≥–∞–¥–∞": 1,
            "–ê–Ω—Ç–∞–ª–∏—è": 4,
            "–¢—É—Ä—Ü–∏—è": 4,
            // Add more cities and their corresponding country IDs as needed
        };

        // Check if the city is in the predefined list
        if (cityCountryMap[cityName]) {
            return cityCountryMap[cityName];
        } else {
            // If not found, use ChatGPT to find the country
            const countryId = await this.getCountryIdFromChatGPT(cityName);
            return countryId;
        }
    }

    async getCountryIdFromChatGPT(cityName) {
        const apiKey = this.OPENAI_API_KEY; // Use the hardcoded OpenAI API key
        const endpoint = 'https://api.openai.com/v1/chat/completions';

        try {
            const response = await axios.post(endpoint, {
                model: 'gpt-3.5-turbo',
                messages: [
                    { 
                        role: 'system', 
                        content: 'You are a helpful assistant. Given a city name, provide the corresponding country ID from the predefined list.'
                    },
                    { 
                        role: 'user', 
                        content: `What is the country ID for the city: ${cityName}?`
                    }
                ],
            }, {
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
            });

            // Extract the country ID from the response
            const countryId = response.data.choices[0].message.content; // Adjust based on the expected response format
            return countryId;
        } catch (error) {
            console.error('Error connecting to ChatGPT:', error);
            return null; // Return null if there is an error
        }
    }

    async getChatGPTResponse(userMessage) {
        const apiKey = this.OPENAI_API_KEY; // Use the hardcoded OpenAI API key
        const endpoint = 'https://api.openai.com/v1/chat/completions';

        try {
            const response = await axios.post(endpoint, {
                model: 'gpt-3.5-turbo',
                messages: [
                    { 
                        role: 'system', 
                        content: 'You are a helpful travel agent assistant. Provide friendly and informative responses about travel-related questions. If someone asks about booking a tour, remind them they can type "—Ç—É—Ä" to start the booking process.'
                    },
                    { 
                        role: 'user', 
                        content: userMessage 
                    }
                ],
            }, {
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                },
            });

            return response.data.choices[0].message.content;
        } catch (error) {
            console.error('Error connecting to ChatGPT:', error);
            return "üö® –ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ ChatGPT. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à API –∫–ª—é—á –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.";
        }
    }

    async askDeparture(msg) {
        await msg.reply('üèôÔ∏è –ò–∑ –∫–∞–∫–æ–≥–æ –≥–æ—Ä–æ–¥–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã–ª–µ—Ç–µ—Ç—å?');
    }

    async askCountry(msg) {
        await msg.reply('üåç –í –∫–∞–∫—É—é —Å—Ç—Ä–∞–Ω—É –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ–µ—Ö–∞—Ç—å?');
    }

    async askNights(msg) {
        await msg.reply('‚åõ –ù–∞ —Å–∫–æ–ª—å–∫–æ –Ω–æ—á–µ–π –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –ø–æ–µ–∑–¥–∫—É?');
    }

    async askAdults(msg) {
        await msg.reply('üë• –°–∫–æ–ª—å–∫–æ –≤–∑—Ä–æ—Å–ª—ã—Ö –ø–æ–µ–¥–µ—Ç? (–≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 6)');
    }

    async askChildren(msg) {
        await msg.reply('üë∂ –°–∫–æ–ª—å–∫–æ –¥–µ—Ç–µ–π –ø–æ–µ–¥–µ—Ç? (–≤–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 0 –¥–æ 4)');
    }

    resetUserState(userId) {
        this.userData.set(userId, {
            isSearching: false,
            awaitingDeparture: false,
            awaitingCountry: false,
            awaitingNights: false,
            awaitingAdults: false,
            awaitingChildren: false,
            departure: null,
            country: null,
            nights: null,
            adults: null,
            children: null
        });
    }

    start() {
        console.log('Starting WhatsApp bot...');
        this.client.initialize()
            .then(() => console.log('Bot initialized successfully'))
            .catch(err => console.error('Failed to initialize bot:', err));
    }
}

// Create and start the bot
const bot = new WhatsAppBot();
bot.start(); 
